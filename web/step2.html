<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Step 2</title>

        <!-- head -->
        <!-- demo stylesheet -->
        <link type="text/css" rel="stylesheet" href="latest/helpers/demo.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/helpers/media/layout.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/helpers/media/elements.css?v=2018.2.232" />   

        <!-- helper libraries -->
        <script src="latest/helpers/jquery-1.9.1.min.js" type="text/javascript"></script>

        <!-- daypilot libraries -->
        <script src="latest/js/daypilot-calendar.src.js" type="text/javascript"></script>
        <script src="latest/js/daypilot-common.src.js" type="text/javascript"></script>
        <!-- daypilot themes -->
        <link type="text/css" rel="stylesheet" href="latest/themes/month_white.css?v=2018.2.232" />
        <link type="text/css" rel="stylesheet" href="latest/themes/month_green.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/themes/month_transparent.css?v=2018.2.232" />    

        <link type="text/css" rel="stylesheet" href="latest/themes/calendar_transparent.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/themes/calendar_white.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/themes/calendar_green.css?v=2018.2.232" />    

        <link type="text/css" rel="stylesheet" href="latest/themes/navigator_green.css?v=2018.2.232" />    
        <link type="text/css" rel="stylesheet" href="latest/themes/navigator_white.css?v=2018.2.232" />    

        <!-- /head -->

        <link rel="stylesheet" href="JMobile/css/themes/default/jquery.mobile-1.4.5.min.css">
        <link rel="stylesheet" href="JMobile/_assets/css/jqm-demos.css">
        <link rel="shortcut icon" href="JMobile/favicon.ico">
        <script src="JMobile/js/jquery.js"></script>
        <script src="JMobile/_assets/js/index.js"></script>
        <script src="JMobile/js/jquery.mobile-1.4.5.min.js"></script>
        <link href="media/mydesign.css" rel="stylesheet" type="text/css"/>

    </head>

    <body>

        <!-- Start of second page: #two -->
        <div data-role="page" id="two" data-theme="a">

            <div data-theme="b" data-role="header">
                <h4>Channeling System</h4>
            </div><!-- /header -->

            <div role="main" class="ui-content">
                <div class="stepwizard">
                    <div class="stepwizard-row setup-panel">
                        <div class="stepwizard-step ">
                            <a href="#step-1" type="button" id="step1" class="btn btn-success btn-circle">1</a>
                        </div>
                        <div class="stepwizard-step ">
                            <a href="#step-2" type="button" id="step2" class="btn btn-success btn-circle">2</a>


                        </div>
                        <div class="stepwizard-step ">
                            <a href="#step-3" type="button" id="step3" class="btn btn-warning btn-circle">3</a>

                            </select>
                        </div>
                        <div class="stepwizard-step ">
                            <a href="#step-4" type="button" id="step4" class="btn btn-warning btn-circle">4</a>

                            </select>
                        </div>
                        <div class="stepwizard-step ">
                            <a href="#step-5" type="button" id="step5" class="btn btn-warning btn-circle">5</a>

                            </select>
                        </div>
                    </div>
                </div>


                <fieldset id="date_mode" data-role="controlgroup" data-type="horizontal" data-mini="true">
                    <legend></legend>
                    <input type="radio" name="radio-choice-a" id="mode-choice-f" value="Week" checked="checked">
                    <label for="mode-choice-f">Week View</label>
                    <input type="radio" name="radio-choice-a" id="mode-choice-g" value="Custom">
                    <label for="mode-choice-g">Available</label>
                </fieldset>
                <fieldset id="date_range" data-role="controlgroup" data-type="horizontal" data-mini="true">
                    <legend></legend>
                    <button id="prev" >Previous</button>

                    <button id="next">Next</button>
                </fieldset>
                <h4 style='text-align: center;margin-top: 0px;margin-bottom: 0px;' id='sum-text'></h4>
                <div id="error-text" class=""></div>
                <div id="dp"></div>
                <form action="step3.html" data-ajax="false">
                    <p style="text-align: right">
                        <a class="ui-input-btn" href="index.html" data-ajax="false" data-role="button" data-inline="true" data-rel="back" >BACK</a>

                        <input type="submit" data-role="button" data-inline="true" data-theme="b" value="NEXT"/>

                    </p>
                </form>
                </p>

            </div><!-- /content -->



            <div data-role="footer">
                <h4>Qatar International</h4>
            </div><!-- /footer -->
        </div><!-- /page two -->
        <script src="js/custom.js" type="text/javascript"></script>
        <script>
            // calendar js

            var dp = new DayPilot.Calendar("dp");
            var selectedSlotCount = 0;

            // view
            dp.startDate = "2018-12-25";  // or just dp.startDate = "2013-03-25";
            dp.viewType = "Week"; // day/week/custom
            dp.viewTypeCustomDateArray = ['2018-12-22', '2018-12-25', '2018-12-26']; // day/week/custom
            var nextAppointmentDays = ['2018-12-27', '2018-12-30', '2019-01-02'];
            var prevAppointmentDays = ['2018-12-01', '2018-12-02', '2019-12-05'];
            dp.initScrollPos = 0; // fixing auto scroll
            dp.durationBarVisible = true;
            //dp.eventDeleteHandling = 'Update';
            dp.slotDurationInMin = 30;
            dp.cellHeight = 35;
            dp.heightSpec = 'BusinessHoursNoScroll';
            dp.headerCellType = 'MiniuteWise';
            dp.businessBeginsHour = 8;
            dp.businessEndsHour = 17;
            dp.rtl = true;
            dp.locale = "ar-ae";
            var maxSlotSelection = 2;
            // event creating
            //dp.timeRangeSelectedHandling = 'JavaScript';
            dp.onTimeRangeSelected = function (args) {
                //var name = prompt("New event name:", "Event");
                //if (!name)
                //   return;
                if (checkMaxSlotsCountExceed(args.start, args.end)) {
                    $('#error-text').addClass('error').text('Maximum selected slot count exceeded');
                    setTimeout(function () {
                        $('#error-text').removeClass('error').text('');
                    }, 3000);


                    dp.clearSelection();
                    return;
                }

                var name = args.start.toString("hh:mm tt") + '-' + args.end.toString("hh:mm tt");

                var e = new DayPilot.Event({
                    start: args.start,
                    end: args.end,
                    id: DayPilot.guid(),
                    text: name
                });

                dp.events.add(e);
                dp.clearSelection();
            };

            dp.onEventResized = function (args) {
                //alert(args.newStart)
                if (checkMaxSlotsCountExceed(args.newStart, args.newEnd)) {
                    $('#error-text').addClass('error').text('Maximum selected slot count exceeded');
                    setTimeout(function () {
                        $('#error-text').removeClass('error').text('');
                    }, 3000);


                    dp.clearSelection();
                    return;
                }
                var e = args.e;
                e.start(args.newStart);
                e.end(args.newEnd);
                dp.events.update(e);
                dp.clearSelection();
            }

            dp.onEventDeleted = function (args) {

                dp.events.remove(args.e);
                selectedSlotCount -= getSelectedSlotsCount(args.e.start(), args.e.end());
            }

            dp.onEventClick = function (args) {
                alert("clicked: " + args.e.id());
            };




            dp.events.list = [
                {
                    "start": "2018-12-25T10:00:00",
                    "end": "2018-12-25T13:00:00",
                    "id": "23ef6fcd-e12d-b085-e38a-a4e23d0bb61d",
                    "text": "Event 1",
                    "backColor": "#FFE599",
                    "borderColor": "#F1C232"
                },
                {
                    "start": "2018-12-25T11:00:00",
                    "end": "2018-12-25T14:00:00",
                    "id": "fb62e2dd-267e-ec91-886b-73574d24e25a",
                    "text": "Event 2",
                    "backColor": "#9FC5E8",
                    "borderColor": "#3D85C6"
                },
                {
                    "start": "2018-12-25T10:00:00",
                    "end": "2018-12-25T13:00:00",
                    "id": "29b7a553-d44f-8f2c-11e1-a7d5f62eb123",
                    "text": "Event 3",
                    "backColor": "#B6D7A8",
                    "borderColor": "#6AA84F"
                },
                {
                    "start": "2018-12-25T14:00:00",
                    "end": "2018-12-25T17:00:00",
                    "id": "ff968cfb-eba1-8dc1-7396-7f0d4f465c8a",
                    "text": "Event 4",
                    "backColor": "#EA9999",
                    "borderColor": "#CC0000",
                    "tags": {
                        "type": "important"
                    }
                }


            ];
            dp.onBeforeEventRender = function (args) {
                if (args.data.tags && args.data.tags.type === "important") {
                    args.data.html = "<b>Important Event</b><br>" + args.data.text;
                    args.data.fontColor = "#fff";
                    args.data.backColor = "#E06666";
                }
            };

            dp.init();

            var e = new DayPilot.Event({
                start: new DayPilot.Date("2018-12-26T12:00:00"),
                end: new DayPilot.Date("2018-12-26T14:00:00").addHours(3),
                id: DayPilot.guid(),
                text: "Special event",
                cssClass: 'booked',
                resizeDisabled: true,
                moveDisabled: true,
                deleteDisabled: true,
                clickDisabled: true,
                barHidden: true

            });
            dp.events.add(e);

            $('input[name="radio-choice-a"]').change(function () {
                var val = $(this).val();

                dp.viewType = val;
                dp.update();


            });



            Date.prototype.addDays = function (days) {
                var date = new Date(this.valueOf());
                date.setDate(date.getDate() + days);
                return date;
            }

            $('#next').click(function () {
                if (dp.viewType === "Week") {
                    dp.startDate = dp.startDate.addDays(+7);
                    dp.update();
                } else {
                    prevAppointmentDays = dp.viewTypeCustomDateArray;
                    dp.viewTypeCustomDateArray = nextAppointmentDays;
                    nextAppointmentDays = GenerateRandomArray('next');
                    dp.update();
                }
            });
            $('#prev').click(function () {
                if (dp.viewType === "Week") {
                    dp.startDate = dp.startDate.addDays(-7);
                    dp.update();
                } else {
                    nextAppointmentDays = dp.viewTypeCustomDateArray;
                    dp.viewTypeCustomDateArray = prevAppointmentDays;
                    prevAppointmentDays = GenerateRandomArray('prev');
                    dp.update();
                }
            });

            $("input[type=submit]").click(function (e) {
                $('#error-text').removeClass('error').text("");

                if (selectedSlotCount < 1) {
                    e.preventDefault();
                    $('#error-text').addClass('error').text("Please select a slot to continue");
                }
            });


            $(document).ready(function () {
                var fcls = [{name: 'Mohammed', id: '1'}, {name: 'Raasil', id: '2'}, {name: 'Abdurrahim', id: '3'}, {name: 'Aboobakr', id: '4'}];
                var sps = [{name: 'Cardiology', id: '1'}, {name: 'Neurology', id: '2'}, {name: 'Paediatrics', id: '3'}, {name: 'Radiology', id: '4'}];
                var fys = [{name: 'Al Emadi Hospital', id: '1'}, {name: 'American Hospital', id: '2'}, {name: 'Emergency Hospitals in Qatar', id: '3'}, {name: 'Hamad General Hospital', id: '4'}];
                var los = [{name: 'Al Shamal', id: '1'}, {name: 'Al Wakra', id: '2'}, {name: 'Doha', id: '3'}, {name: 'Umm Said', id: '4'}];
                var sumtxt = [];
                var fclsid = getNameFromJson(fcls, getUrlParameter('fcr-menu'));
                var spssid = getNameFromJson(sps, getUrlParameter('spc-menu'));
                var fyssid = getNameFromJson(fys, getUrlParameter('fcy-menu'));
                var losid = getNameFromJson(los, getUrlParameter('loc-menu'));

                if (fclsid) {
                    sumtxt.push(fclsid);
                }
                if (spssid) {
                    sumtxt.push(spssid);
                }
                if (fyssid) {
                    sumtxt.push(fyssid);
                }
                if (losid) {
                    sumtxt.push(losid);
                }



                //sumtxt += getNameFromJson(fcls,fclsid) +', '+ getNameFromJson(sps,spssid) 
                //       +', '+ getNameFromJson(fys,fyssid) +', '+ getNameFromJson(los,losid);
                $('#sum-text').text(sumtxt.join(', '));



            })



            var getSelectedSlotsCount = function getSelectedSlotsCount(start, end) {

                return ((new Date(end) - new Date(start)) / (1000 * 60)) / dp.slotDurationInMin;

            }

            var checkMaxSlotsCountExceed = function checkMaxSlotsCountExceed(start, end) {
                var crntSelCount = getSelectedSlotsCount(start, end);
                if (selectedSlotCount + crntSelCount > maxSlotSelection) {
                    return true;
                } else {
                    selectedSlotCount += crntSelCount;
                }
            }



        </script>

    </body>
</html>
